---
title: 운영체제 5. 교착상태
date: 2018-12-05
categories:
- Operating System
tags:
- Operating System
- Study
---

# 01 교착상태의 개요
## 1. 교착상태의 정의
- 교착상태 : 2개 이상의 프로세스가 다른 프로세스의 작업이 끝나기만 기다리며 작업을 더 이상 진행하지 못하는 상태

## 2. 교착상태의 발생
- 시스템 자원
  - 다른 프로세스와 공유할 수 없는 자원을 사용할 때 발생
  - 예 : 어떤 프로세스가 임계구역으로 보호되는 프린터, 스캐너, CD 레코더 등 동시에 같이 사용할 수 없는 시스템 자원을 할당받은 후 양보하지 않는 경우
- 공유 변수
  - 무한 대기를 막지 못해 교착 상태가 발생한 경우
- 응용 프로그램
  - 데이터의 일관성 유지위해 잠금 사용 -> 교착 상태 발생할 수 있음

## 3. 자원 할당 그래프
- 자원 할당 그래프 : 프로세스가 어떤 자원을 사용 중이고 어떤 자원을 기다리고 있는지를 방향성이 있는 그래프로 표현한 것

- 프로세스 : 원 / 자원 : 사각형
- 사용 중(할당된 경우) : 자원 -> 프로세스
- 프로세스가 자원을 기다리는 중(대기하는 경우) : 프로세스 -> 자원

- 다중자원 <sup>multiple resource</sup> : 여러 프로세스가 하나의 자원을 동시 사용

# 02 교착 상태 필요조건
## 1. 교착 상태 필요조건
- 상호 배제: 한 프로세스가 사용하는 자원은 다른 프로세스와 공유할 수 없는 배타적인 자원이어야 한다. 배타적인 자원은 임계구역으로 보호되기 때문에 다른 프로세스가 동시에 사용할 수 없다.

- 비선점 : 한 프로세스가 사용 중인 자원은 중간에 다른 프로세스가 빼앗을 수 없는 비선점 자원이여야 한다. 어떤 자원을 빼앗을 수 있다면 시간 간격을 두고 자원을 공유할 수 있다.

- 점유와 대기 : 프로세스가 어떤 자원으로 할당받은 상태에서 다른 자원을 기다리는 상태여야 한다.

- 원형 대기 : 점유와 대기를 하는 프로세스 간의 관계가 원을 이루어야 한다. 점유와 대기를 하는 프로세스들이 서로 방해하는 방향이 원을 이루면 교착상태에 빠짐

## 2. 식사하는 철학자 문제와 교착 상태 필요조건

- 아사현상과 교착상태는 다르다
  - 아사현상 : 정책상 잘못이나 오류로 인해 특정 프로세스의 작업이 이루어지지 않는것 (에이징으로 해결)
  - 교착상태 : 자연적으로 발생

# 03 교착 상태 해결 방법
## 1. 교착 상태 해결 방법

|해결방법 | 특징|
| --- | --- |
| 교착 상태 예방|교착 상태를 유발하는 네가지 조건을 무력화|
| 교착 상태 회피|교착 상태가 발생하지 않는 수준으로 자원을 할당|
| 교착 상태 검출|자원 할당 그래프를 사용하여 교착 상태를 발견|
| 교착 상태 회복|교착 상태를 검출한 후 해결|

## 2. 교착 상태 예방
### 2.1 상호 배제 예방
- 상호 배타적인 모든 자원, 독점적으로 사용할 수 있는 자원을 없애버리는 방법
- 현실적으로 불가능
### 2.2 비선점 예방
- 모든 자원을 빼앗을수 있도록 하는 방법
- 아사현상을 야기
### 2.3 점유와 대기 예방
- 프로세스가 자원을 점유한 상태에서 다른 자원을 기다리지 못하게 하는 방법

- all or nothing 방식 : 전부 할당하거나 아니면 아예 할당하지 않는 방식

  - 프로세스가 자신이 사용하는 모든 자원을 자세히 알기 어렵다 : 프로세스가 필요한 자원을 모두 확보한 후 실행했는데 추가로 필요한 자원이 생기면 다시 확보하기 어려움
  - 자원의 활용성이 떨어진다 : 앞으로 사용할 자원까지 미리 선점하므로 자원 낭비가 심하다
많은 자원을 사용하는 프로세스가 적은 자원을 사용하는 프로세스보다 불리하다 : 자원을 많이 사용하는 프로세스는 자원을 적게 사용하는 프로세스보다 자원을 동시에 확보하기가 어려워 아사현상이 발생한다.
  - 결국 일괄 작업 방식으로 동작한다 : 점유와 대기 예방을 실제로 구현하면 거의 모든 프로세스가 일괄 작업 방식으로 처리된다.

### 2.4 원형 대기 예방
- 자원을 한방향으로만 사용하도록 설정하므로써 원형 대기를 예방할 수 있음

- 프로세스 작업 진행에 유연성이 떨어진다
- 자원의 번호를 어떻게 부여할 것인지가 문제이다

## 3. 교착상태 회피
### 3.1 교착 상태 회피의 개념
- 프로세스에 자원을 할당할 때 어느 수준 이상의 자원을 나누어주면 교착 상태가 발생하는지 파악하여 그 수준 이하로 자원을 나누어주는 방법

- 교착 상태 회피는 자원의 총수와 현재 할당된 자원의 수를 기준으로 시스템을 안정 상태와 불안정 상태로 나누고 시스템이 안정 상태를 유지하도록 자원을 할당한다.

### 3.2 은행원 알고리즘<sup>banker’s algorithm</sup>
- 각 프로세스는 자신이 사용할 자원의 최대수<sup>Max</sup>를 운영체제에 알려줌


|변수 | 설명|
| --- | --- |
|전체자원|시스템 내 전체 자원의 수|
|가용자원|시스템 내 현재 사용할 수 있는 자원의 수(전체자원-할당자원)|
|최대자원|각 프로세스가 선언한 최대 자원의 수|
|할당자원|각 프로세스에 현재 할당된 자원의 수|
|기대자원|각 프로세스가 앞으로 사용할 자원의 수(최대자원-할당자원)|


- 안정상태 : 각 프로세스의 기대 자원과 비교하여 가용 자원이 크거나 같은 경우가 한 번 이상인 경우


### 3.3 교착 상태 회피의 문제점
- 프로세스가 자신이 사용할 모든 자원을 미리 선언해야 한다.
- 시스템의 전체 자원 수가 고정적이어야 한다.
- 자원이 낭비된다.

## 4. 교착 상태 검출 - 가장 현실적인 접근
### 4.1 교착 상태 검출의 개념
### 4.2 타임아웃을 이용한 교착 상태 검출 (가벼운 교착상태 검출)

- 일정 시간 동안 작업이 진행되지 않은 프로세스를 교착 상태가 발생한 것으로 간주하여 처리하는 방법
  - 엉뚱한 프로세스가 강제 종료될 수 있다
  - 모든 시스템에 적용할 수 없다


- 타임 아웃으로 데이터의 일관성이 깨지는 문제를 해결하기 위해
  - 체크포인트<sup>check point</sup> : 현재의 시스템 상태가 하드디스크에 저장
  - 스냅숏<sup>snap shot</sup> : 체크 포인트에 저장된 데이터
  - 롤백<sup>roll back</sup> : 작업을 하다가 문제가 발생하여 과거의 체크포인트로 되돌아 가는 것

### 4.3 자원 할당 그래프를 이용한 교착 상태 검출 (무거운 교착상태 검출)
교착 상태가 없는 자원 할당 그래프 : 사이클이 존재 X
교착 상태가 있는 자원 할당 그래프 :  사이클이 발생하면 교착상태가 검출된 것으로 판단

단점 : 자원 할당 그래프를 유지/갱신/사이클 검사로 인해 오버헤드가 발생

## 5. 교착 상태 회복 - 가장 현실적인 접근
- 교착 상태를 일으킨 모든 프로세스를 동시에 종료 : 종료된 프로세스들이 동시 작업을 시작하면서 다시 교착 상태 일으킬 가능성이 있으므로 순차적 실행필요

- 교착 상태를 일으킨 프로세스 중 하나를 골라 순서대로 종료 : 어떤 프로세스부터 종료할 것인지 기준이 필요
우선순위 낮은 프로세스
작업시간 짧은 프로세스
자원을 많이 사용하는 프로세스
